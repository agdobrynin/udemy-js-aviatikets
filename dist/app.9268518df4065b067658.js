!function(e){function t(t){for(var r,o,c=t[0],u=t[1],s=t[2],f=0,h=[];f<c.length;f++)o=c[f],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&h.push(i[o][0]),i[o]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);for(l&&l(t);h.length;)h.shift()();return a.push.apply(a,s||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,c=1;c<n.length;c++){var u=n[c];0!==i[u]&&(r=!1)}r&&(a.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},i={1:0},a=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var c=window.webpackJsonp=window.webpackJsonp||[],u=c.push.bind(c);c.push=t,c=c.slice();for(var s=0;s<c.length;s++)t(c[s]);var l=u;a.push([361,0]),n()}({361:function(e,t,n){"use strict";n.r(t);n(342),n(343);var r={endpoint:"https://aviasales-api.herokuapp.com",cache:{ttl:2592e6,ttlAirlines:864e5},dateConfig:{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"},locale:"ru-RU",datePickerI18n:{cancel:"Отмена",clear:"Очистить",done:"Выбрать",months:["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"],monthsShort:["янв.","февр.","март","апр.","май","июнь","июль","авг.","сент.","окт.","нояб.","дек."],weekdays:["понедельник","вторник","среда","четверг","пятница","суббота","воскресенье"],weekdaysShort:["пп","вт","ср","чт","пт","сб","вс"],weekdaysAbbrev:["пн","вт","ср","чт","пт","сб","вс"]}};function i(e){return"".concat("cities-autocomplete:").concat(e.name)}function a(e){var t=document.querySelectorAll("select");M.FormSelect.init(t);var n=document.querySelectorAll(".autocomplete");M.Autocomplete.init(n,{limit:10,minLength:3,onAutocomplete:function(){e.setValue(i(this.el),this.el.value,864e5)}}),Array.from(n).forEach((function(t){var n=e.getItem(i(t));e.isExpired(n)||(t.value=n.value)}));var a=document.querySelectorAll(".datepicker");M.Datepicker.init(a,{i18n:r.datePickerI18n||{},showClearBtn:!0,format:"mmmm, yyyy",minDate:new Date,setDefaultDate:!0,defaultDate:new Date,autoClose:!0,onSelect:function(e){if("date-departure"===this.el.name){var t=c(document.querySelector("[name='date-return']"));t.options.minDate=e,t.setDate(e),t.setInputValue()}}}),M.Sidenav.init(document.querySelector("#favorite-tickets"));var o=document.querySelectorAll(".tooltipped");M.Tooltip.init(o)}function o(e){return M.Autocomplete.getInstance(e)}function c(e){return M.Datepicker.getInstance(e)}var u=n(53),s=n.n(u);function l(e,t,n,r,i,a,o){try{var c=e[a](o),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,i)}function f(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){l(a,r,i,o,c,"next",e)}function c(e){l(a,r,i,o,c,"throw",e)}o(void 0)}))}}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var v=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.endpoint=t.endpoint}var t,n,r,i,a,o,c;return t=e,(n=[{key:"countries",value:(c=f(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.a.get("".concat(this.endpoint,"/countries"));case 3:return t=e.sent,e.abrupt("return",t.data);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",Promise.reject(e.t0));case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return c.apply(this,arguments)})},{key:"cities",value:(o=f(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.a.get("".concat(this.endpoint,"/cities"));case 3:return t=e.sent,e.abrupt("return",t.data);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",Promise.reject(e.t0));case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return o.apply(this,arguments)})},{key:"airlines",value:(a=f(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.a.get("".concat(this.endpoint,"/airlines"));case 3:return t=e.sent,e.abrupt("return",t.data);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",Promise.reject(e.t0));case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return a.apply(this,arguments)})},{key:"prices",value:(i=f(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.a.get("".concat(this.endpoint,"/prices/cheap"),{params:t});case 3:return n=e.sent,e.abrupt("return",n.data);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",Promise.reject(e.t0));case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(e){return i.apply(this,arguments)})}])&&h(t.prototype,n),r&&h(t,r),e}();function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=function(){function e(t){var n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.code=(null==t?void 0:t.code)||void 0,this.name=(null==t?void 0:t.name)||(null==t||null===(n=t.name_translations)||void 0===n?void 0:n.en)||void 0,this.nameEn=(null==t||null===(r=t.name_translations)||void 0===r?void 0:r.en)||(null==t?void 0:t.nameEn)||void 0}var t,n,r;return t=e,(n=[{key:"getLogoUrl",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return void 0===this.code?"":"http://pics.avs.io/".concat(e,"/").concat(t,"/").concat(this.code,".png")}}])&&d(t.prototype,n),r&&d(t,r),e}();function y(e,t,n,r,i,a,o){try{var c=e[a](o),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,i)}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t,n){return t&&g(e.prototype,t),n&&g(e,n),e}var w=function(){function e(){var t;m(this,e),this.localStorage=null===(t=window)||void 0===t?void 0:t.localStorage}var t,n;return b(e,[{key:"getItem",value:function(e){var t=this.localStorage.getItem(e);return null===t?new _:new _(JSON.parse(t))}},{key:"isExpired",value:function(e){return Date.now()>e.expireAt}},{key:"getValue",value:(t=regeneratorRuntime.mark((function e(t,n){var r,i,a,o,c=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=c.length>2&&void 0!==c[2]?c[2]:6e4,0!==(i=parseInt(r)||0)){e.next=8;break}return e.t0=Promise,e.next=6,n();case 6:return e.t1=e.sent,e.abrupt("return",e.t0.resolve.call(e.t0,e.t1));case 8:if(a=this.getItem(t),this.isExpired(a)){e.next=11;break}return e.abrupt("return",Promise.resolve(a.value));case 11:return e.next=13,n();case 13:return o=e.sent,this.setValue(t,o,i),e.abrupt("return",Promise.resolve(o));case 16:case"end":return e.stop()}}),e,this)})),n=function(){var e=this,n=arguments;return new Promise((function(r,i){var a=t.apply(e,n);function o(e){y(a,r,i,o,c,"next",e)}function c(e){y(a,r,i,o,c,"throw",e)}o(void 0)}))},function(e,t){return n.apply(this,arguments)})},{key:"setValue",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6e4,r=parseInt(n)||0;if(0===r)throw new Error("Can't set cache with ttl value = ".concat(r));var i=new _;i.expireAt=Date.now()+r,i.value=t,this.localStorage.setItem(e,JSON.stringify(i.getItem()))}}]),e}(),_=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};m(this,e),this.expireAt=(null==t?void 0:t.expireAt)||0,this.value=(null==t?void 0:t.value)||{}}return b(e,[{key:"setValue",value:function(e){this.value=e}},{key:"getItem",value:function(){return{expireAt:this.expireAt,value:this.value}}}]),e}();function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function D(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var C=function(){function e(t){var n,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";k(this,e),this.code=t.code||void 0,this.countryCode=(null==t?void 0:t.country_code)||(null==t?void 0:t.countryCode)||void 0,this.name=(null==t?void 0:t.name)||(null==t||null===(n=t.name_translations)||void 0===n?void 0:n.en)||t.code,this.nameEn=(null==t||null===(r=t.name_translations)||void 0===r?void 0:r.en)||t.name,this.countryName=i||(null==t?void 0:t.countryName)||void 0}var t,n,r;return t=e,(n=[{key:"setCountryName",value:function(e){this.countryName=e}},{key:"getFullName",value:function(){return"".concat(this.name,", ").concat(this.countryName)}}])&&D(t.prototype,n),r&&D(t,r),e}();var A=function e(t){var n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.code=t.code||void 0,this.name=(null==t?void 0:t.name)||(null==t||null===(n=t.name_translations)||void 0===n?void 0:n.en)||t.code||void 0,this.nameEn=(null==t||null===(r=t.name_translations)||void 0===r?void 0:r.en)||t.code};function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var x=function(){function e(t,n,r,i,a){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.flightNumber=(null==t?void 0:t.flight_number)||(null==t?void 0:t.flightNumber)||void 0,this.price=t.price,this.transfers=t.transfers,this.currency=a,!(n instanceof p))throw new Error('Переданный параметр "Авиакомпания" не является AirlineDto');if(this._airline=n,!(r instanceof C))throw new Error('Переданный параметр "Город отправления" не является CityDto');if(this._cityDeparture=r,!(i instanceof C))throw new Error('Переданный параметр "Город назначения" не является CityDto');this._cityDestination=i,this._dateDepartureAt=new Date((null==t?void 0:t.departure_at)||(null==t?void 0:t._dateDepartureAt)||""),this._dateReturnAt=new Date((null==t?void 0:t.return_at)||(null==t?void 0:t._dateReturnAt)||""),this._expiresAt=new Date((null==t?void 0:t.expires_at)||(null==t?void 0:t._expiresAt)||"")}var t,n,r;return t=e,(n=[{key:"id",value:function(){var e="".concat(this._cityDeparture.code,":").concat(this._cityDestination.code),t="".concat(this._dateDepartureAt.toUTCString(),":").concat(this._dateReturnAt.toUTCString()),n="".concat(this.flightNumber,":").concat(this._airline.code);return"".concat(n,":").concat(e,":").concat(t)}},{key:"getDepartureCity",value:function(){return this._cityDeparture.getFullName()}},{key:"getDestinationCity",value:function(){return this._cityDestination.getFullName()}},{key:"getDepartureDate",value:function(){return this._dateDepartureAt}},{key:"getReturnDate",value:function(){return this._dateReturnAt}},{key:"getExpireDate",value:function(){return this._expiresAt}},{key:"getAirLine",value:function(){return this._airline}}])&&S(t.prototype,n),r&&S(t,r),e}();function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return R(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return R(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function P(e,t,n,r,i,a,o){try{var c=e[a](o),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,i)}function j(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){P(a,r,i,o,c,"next",e)}function c(e){P(a,r,i,o,c,"throw",e)}o(void 0)}))}}function O(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var T=new(function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;O(this,e),this.api=t,this.config=n,this.cache=r,this.countryCacheKey="countries",this.countries=null,this.citiesCacheKey="cities",this.cities=null,this.citiesForAutocomplete={},this.airlinesCacheKey="airlines",this._searchResultWithFlightCards={}}var t,n,r,i,a;return t=e,(n=[{key:"init",value:(a=j(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o,c,u,s,l,f,h,v,d,p=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=(null===(t=this.config)||void 0===t||null===(n=t.cache)||void 0===n?void 0:n.ttl)||0,s=(null===(r=this.config)||void 0===r||null===(i=r.cache)||void 0===i?void 0:i.ttlAirlines)||0,e.next=4,Promise.all([(null===(a=this.cache)||void 0===a?void 0:a.getValue(this.countryCacheKey,(function(){return p.api.countries()}),u))||this.api.countries(),(null===(o=this.cache)||void 0===o?void 0:o.getValue(this.citiesCacheKey,(function(){return p.api.cities()}),u))||this.api.cities(),(null===(c=this.cache)||void 0===c?void 0:c.getValue(this.airlinesCacheKey,(function(){return p.api.airlines()}),s))||this.api.airlines()]);case 4:return l=e.sent,f=E(l,3),h=f[0],v=f[1],d=f[2],this.countries=this._serializeCountries(h),this.cities=this._serializeCities(v),this.airlines=this._serializeAirlines(d),e.abrupt("return",l);case 10:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"_serializeCountries",value:function(e){return e.reduce((function(e,t){var n=new A(t);return e[n.code]=n,e}),{})}},{key:"_serializeCities",value:function(e){var t=this;return e.reduce((function(e,n){var r,i=new C(n);return i.setCountryName(null===(r=t.countries[i.countryCode])||void 0===r?void 0:r.name),e[i.code]=i,e}),{})}},{key:"_serializeAirlines",value:function(e){return e.reduce((function(e,t){var n=new p(t);return n.code&&(e[n.code]=n),e}),{})}},{key:"getCities",value:function(){if(null===this.cities)throw new Error("First call LocalStore.init()");return this.cities}},{key:"getAirlines",value:function(){if(null===this.cities)throw new Error("First call LocalStore.init()");return this.airlines}},{key:"fetchTickets",value:(i=j(regeneratorRuntime.mark((function e(t){var n,r,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.prices(t.getRequestParams());case 2:return n=e.sent,this._searchResultWithFlightCards={},r=Object.values(n.data).map((function(e){var t=i.getAirlines()[e.airline],r=i.getCities()[e.origin],a=i.getCities()[e.destination],o=new x(e,t,r,a,n.currency);return i._searchResultWithFlightCards[o.id()]=o,o})),e.abrupt("return",Promise.resolve(r));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getSearchResultWithFlightCards",value:function(){return this._searchResultWithFlightCards}},{key:"getCountries",value:function(){if(null===this.countries)throw new Error("First call LocalStore.init()");return this.countries}},{key:"getCitiesForAutocomplete",value:function(){return Object.values(this.cities).reduce((function(e,t){return e[t.getFullName()]=null,e}),{})}},{key:"getCityCodeByAutocompleteName",value:function(e){if(""===e.trim())throw new Error("Не установлен город");if(null===this.cities)throw new Error("Dictionary cities not loaded from API. First initialize the app");var t=Object.values(this.cities).find((function(t){return t.getFullName()===e}));if(!(t instanceof C))throw new Error('City CODE not found by full name "'.concat(e,'"'));return t.code}}])&&F(t.prototype,n),r&&F(t,r),e}())(new v(r),r,new w);function L(e){return function(e){if(Array.isArray(e))return I(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return I(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return I(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var q=function(){function e(t,n,r,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._form=t,this._buttons=Array.from(t.querySelectorAll("button")),this._inputDeparture=n,this._inputDestination=r,this._inputDateDeparture=i,this._inputDateReturn=a,this._fields=[this._inputDeparture,this._inputDestination,this._inputDateDeparture,this._inputDateReturn]}var t,n,r;return t=e,(n=[{key:"setCurrencySelect",value:function(e){this._currencySelect=e}},{key:"getCurrencyValue",value:function(){var e;return(null===(e=this._currencySelect)||void 0===e?void 0:e.value)||"USD"}},{key:"getForm",value:function(){return this._form}},{key:"disableForm",value:function(){[].concat(L(this._fields),L(this._buttons)).forEach((function(e){e.setAttribute("disabled","disabled")}))}},{key:"undisableForm",value:function(){[].concat(L(this._fields),L(this._buttons)).forEach((function(e){e.removeAttribute("disabled")}))}},{key:"loading",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;e?t.classList.remove("hide"):t.classList.add("hide")}},{key:"getCityDeparture",value:function(){return this._inputDeparture.value}},{key:"getCityDestination",value:function(){return this._inputDestination.value}},{key:"getDateDeparture",value:function(){return c(this._inputDateDeparture).date}},{key:"getDateReturn",value:function(){return c(this._inputDateReturn).date}},{key:"setAutocompliteData",value:function(e){o(this._inputDeparture).updateData(e),o(this._inputDestination).updateData(e)}}])&&N(t.prototype,n),r&&N(t,r),e}();function V(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var U=function(){function e(t,n,r,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._cityDepartureCode=t,this._cityDestinationCode=n,this._dateDeparture=r,this._dateReturn=i,this._currency=a}var t,n,r;return t=e,(n=[{key:"getRequestParams",value:function(){var e=this._dateDeparture||new Date,t=this._dateReturn||new Date,n=["".concat(e.getMonth()+1).padStart(2,"0"),"".concat(t.getMonth()+1).padStart(2,"0")],r=n[0],i=n[1];return{origin:this._cityDepartureCode,destination:this._cityDestinationCode,depart_date:"".concat(e.getFullYear(),"-").concat(r),return_date:"".concat(t.getFullYear(),"-").concat(i),currency:this._currency}}}])&&V(t.prototype,n),r&&V(t,r),e}();function K(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var z=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._flightCard=t,this._currenciesStore=n,this._config=r}var t,n,r;return t=e,(n=[{key:"insert",value:function(e){e.insertAdjacentHTML("beforeend",this._renderFlightCard())}},{key:"formatDate",value:function(e){var t=this._config.locale||"",n=this._config.dateConfig||{};return e.toLocaleString(t,n)}},{key:"_renderFlightCard",value:function(){return'\n      <div class="col s12 m6 flightCard">\n        <div class="card hoverable">\n          <div class="card-title airline-title">\n            <div class="row valign-wrapper">\n              <div class="col s8 center-align">\n                <h4 class="truncate tooltipped" data-position="bottom" data-tooltip="'.concat(this._flightCard.getAirLine().name.replace('"',"&quot;"),'">\n                  ').concat(this._flightCard.getAirLine().name,'\n                </h4>\n              </div>\n              <div class="col s4 airline-logo center-align">\n                <img src="').concat(this._flightCard.getAirLine().getLogoUrl(),'" class="responsive-img valign" alt="').concat(this._flightCard.getAirLine().name,'">\n              </div>\n            </div>\n          </div>\n          <div class="card-content">\n            <div class="row">\n              <div class="col s6 center-align">\n                <div>').concat(this._flightCard.getDepartureCity(),'</div>\n                <div><i class="small material-icons">arrow_downward</i></div>\n                <div>').concat(this._flightCard.getDestinationCity(),'</div>\n              </div>\n              <div class="col s6 center-align">\n                <div>').concat(this._flightCard.getDestinationCity(),'</div>\n                <div class="center-align"><i class="small material-icons">arrow_downward</i></div>\n                <div>').concat(this._flightCard.getDepartureCity(),'</div>\n              </div>\n              <div class="col s6 center-align">').concat(this.formatDate(this._flightCard.getDepartureDate()),'</div>\n              <div class="col s6 center-align">').concat(this.formatDate(this._flightCard.getReturnDate()),'</div>\n              <div class="col s12">\n                <ul class="flight-details">\n                  <li><i class="material-icons">transfer_within_a_station</i> <span>Пересадок</span>: <b>').concat(this._flightCard.transfers,'</b></li>\n                  <li><i class="material-icons">event_available</i> <span>Номер рейса</span>: <b>').concat(this._flightCard.flightNumber,'</b></li>\n                  <li><i class="material-icons">block</i> <span>Актуален до</span>: <b>').concat(this.formatDate(this._flightCard.getExpireDate()),'</b></li>\n                </ul>\n              </div>\n            </div>\n          </div>\n          <div class="card-action airline-action">\n            <div class="row valign-wrapper">\n              <div class="col s6">\n                <h5 class="teal lighten-2 white-text ticket-price center-align">\n                  ').concat(this._currenciesStore.getFormatPrice(this._flightCard.price,this._flightCard.currency),'\n                </h5>\n              </div>\n              <div class="col s6">\n                <a class="add-to-favorite-icon btn-floating btn-small waves-effect waves-light right tooltipped" data-position="top"\n                  data-tooltip="Add to favorite">\n                  <i class="material-icons add-to-favorite" data-id="').concat(this._flightCard.id(),'">favorite</i>\n                </a>\n                <a class="remove-from-favorite-icon btn-floating btn-small waves-effect waves-light right tooltipped" data-position="top"\n                  data-tooltip="Remove from favorite">\n                  <i class="material-icons remove-from-favorite" data-id="').concat(this._flightCard.id(),'">favorite_border</i>\n                </a>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      ')}}])&&K(t.prototype,n),r&&K(t,r),e}();function B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var W={USD:"Доллар США",EUR:"Евро",RUB:"Рубль"},H=function(){function e(t,n,r){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.code=W,this._locale=t.locale||"ru-RU",this._cache=r,this._selectElement=n,Object.keys(this.code).forEach((function(e){i._selectElement.insertAdjacentHTML("beforeend",'<option value="'.concat(e,'">').concat(i.code[e],"</option>"))}));var a=t.cache.ttl,o=this._cache.getItem("currency");this._cache.isExpired(o)||(this._selectElement.value=o.value),this._selectElement.addEventListener("change",(function(e){i._cache.setValue("currency",e.target.value,a)}))}var t,n,r;return t=e,(n=[{key:"getCurrentCurrency",value:function(){return this._selectElement.value}},{key:"getFormatPrice",value:function(e,t){return e.toLocaleString(this._locale,{style:"currency",currency:t})}}])&&B(t.prototype,n),r&&B(t,r),e}();function J(e,t,n,r,i,a,o){try{var c=e[a](o),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,i)}function Y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var $=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._cacheKey="favorites",this._config=t,this._cache=n,this._favorites={}}var t,n,r,i,a;return t=e,(n=[{key:"init",value:(i=regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve(this._cache.getValue(this._cacheKey,(function(){return{}}),this._config.cache.ttl));case 2:t=e.sent,Object.keys(t).forEach((function(e){var r=new p(t[e]._airline),i=new C(t[e]._cityDeparture),a=new C(t[e]._cityDestination),o=new x(t[e],r,i,a,t[e].currency);n._favorites[o.id()]=o}));case 4:case"end":return e.stop()}}),e,this)})),a=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=i.apply(e,t);function o(e){J(a,n,r,o,c,"next",e)}function c(e){J(a,n,r,o,c,"throw",e)}o(void 0)}))},function(){return a.apply(this,arguments)})},{key:"getFavorites",value:function(){return Object.values(this._favorites)}},{key:"hasFlightCards",value:function(){return Boolean(Object.keys(this._favorites).length)}},{key:"add",value:function(e){var t=e.id();if(this._favorites[t])throw Error("Рейс уже содержится в избранных");this._favorites[t]=e,this._cache.setValue(this._cacheKey,this._favorites,this._config.cache.ttl)}},{key:"has",value:function(e){return Boolean(this._favorites[e])}},{key:"remove",value:function(e){this._favorites[e]&&(delete this._favorites[e],this._cache.setValue(this._cacheKey,this._favorites,this._config.cache.ttl))}}])&&Y(t.prototype,n),r&&Y(t,r),e}();function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Q=function(){function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._favoritesStore=t,this._currenciesStore=n,this._config=r,this._favoriteTicketsDiv=i}var t,n,r;return t=e,(n=[{key:"getDestinationDiv",value:function(){return this._favoriteTicketsDiv}},{key:"update",value:function(e){var t=this;this._favoriteTicketsDiv.innerHTML="",this._favoritesStore.hasFlightCards()&&this._favoritesStore.getFavorites().forEach((function(e){new z(e,t._currenciesStore,t._config).insert(t._favoriteTicketsDiv)})),"function"==typeof e&&e()}}])&&G(t.prototype,n),r&&G(t,r),e}();function X(e,t,n,r,i,a,o){try{var c=e[a](o),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,i)}function Z(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){X(a,r,i,o,c,"next",e)}function c(e){X(a,r,i,o,c,"throw",e)}o(void 0)}))}}document.addEventListener("DOMContentLoaded",Z(regeneratorRuntime.mark((function e(){var t,n,i,o,c,u,s,l,f,h,v,d,p,y,m,g;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:g=function(){return(g=Z(regeneratorRuntime.mark((function e(t){var n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.loading(!0,c),n=new U(T.getCityCodeByAutocompleteName(t.getCityDeparture()),T.getCityCodeByAutocompleteName(t.getCityDestination()),t.getDateDeparture(),t.getDateReturn(),l.getCurrentCurrency()),t.disableForm(),e.next=6,T.fetchTickets(n);case 6:a=e.sent,i.innerHTML="",0===a.length&&M.toast({html:"Рейсов не найдено.",classes:"blue",displayLength:5e3}),a.forEach((function(e){new z(e,l,r).insert(i),M.Tooltip.init(i.querySelectorAll(".tooltipped"))})),t.undisableForm(),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),M.toast({html:e.t0.message,classes:"red",displayLength:1e4});case 16:return e.prev=16,t.loading(!1,c),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[0,13,16,19]])})))).apply(this,arguments)},m=function(e){return g.apply(this,arguments)},y=function(e){var t;if(null!==(t=e.target)&&void 0!==t&&t.classList.contains("remove-from-favorite")){var n,r,i=(null===(n=e.target)||void 0===n||null===(r=n.dataset)||void 0===r?void 0:r.id)||"";i&&(s.remove(i),M.Tooltip.getInstance(e.target.closest("a")).destroy(),M.toast({html:"Рейс удален из избранного",classes:"teal lighten-2"}),h.update((function(){return M.Tooltip.init(h.getDestinationDiv().querySelectorAll(".tooltipped"))})))}},p=function(e){var t;if(null!==(t=e.target)&&void 0!==t&&t.classList.contains("add-to-favorite")){var n,r,i=(null===(n=e.target)||void 0===n||null===(r=n.dataset)||void 0===r?void 0:r.id)||"";if(i)try{s.add(T.getSearchResultWithFlightCards()[i]),M.toast({html:"Рейс добавлен в избранное",classes:"blue"}),h.update((function(){return M.Tooltip.init(h.getDestinationDiv().querySelectorAll(".tooltipped"))}))}catch(e){M.toast({html:e.message,classes:"red"})}}},d=function(){return(d=Z(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.disableForm(),t.loading(!0,c),e.next=5,T.init();case 5:return t.setAutocompliteData(T.getCitiesForAutocomplete()),e.next=8,s.init();case 8:n.update((function(){return M.Tooltip.init(n.getDestinationDiv().querySelectorAll(".tooltipped"))})),t.undisableForm(),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),M.toast({html:e.t0.message,classes:"red",displayLength:1e4});case 15:return e.prev=15,t.loading(!1,c),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[0,12,15,18]])})))).apply(this,arguments)},v=function(e,t){return d.apply(this,arguments)},t=document.forms["search-tickets"],n=document.querySelector("select[name='currency']"),i=document.querySelector("div#aviatikets-search-result"),o=document.querySelector("#favorite-tickets"),c=document.querySelector("#loader"),u=new w,s=new $(r,u),l=new H(r,n,u),f=new q(t,t["city-departure"],t["city-destination"],t["date-departure"],t["date-return"]),h=new Q(s,l,r,o),v(f,h),a(u),t.addEventListener("submit",(function(e){e.preventDefault(),m(f)})),i.addEventListener("click",p),o.addEventListener("click",y);case 21:case"end":return e.stop()}}),e)}))))}});